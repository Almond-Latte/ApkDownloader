# ApkDownloader

![Static Badge](https://img.shields.io/badge/Python-3.13-blue) ![VirusTotal](https://img.shields.io/badge/AndroZoo-API-orange)

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ [AndroZoo API](https://androzoo.uni.lu/) ã‚’ç”¨ã„ã¦ã€ãƒãƒƒã‚·ãƒ¥å€¤ãƒªã‚¹ãƒˆã‹ã‚‰ç°¡å˜ã«APKãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

APKãƒãƒƒã‚·ãƒ¥å€¤ãƒªã‚¹ãƒˆã¯AndroZooãŒå…¬é–‹ã—ã¦ã„ã‚‹ [Lists of APKs](https://androzoo.uni.lu/lists) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚


## ğŸš€ ç‰¹å¾´

- **APKãƒ•ã‚¡ã‚¤ãƒ«ã®ç°¡å˜å–å¾—:** AndroZoo API ã‚’åˆ©ç”¨ã—ã¦ã€ç°¡å˜ã«APKãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã§ãã¾ã™ã€‚
- **è‡ªå‹•åŒ–**: ãƒãƒƒã‚·ãƒ¥å€¤ãƒªã‚¹ãƒˆ([Lists of APKs](https://androzoo.uni.lu/lists))ã‚’ã‚‚ã¨ã«ã€è‡ªå‹•çš„ã«APKãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¾ã™ã€‚
- **ãƒªãƒƒãƒãªCLIè¡¨ç¤º**: `rich`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¡ç”¨ã—ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰çŠ¶æ³ã‚’ã¾ã‚‹ã§GUIã‹ã®ã‚ˆã†ã«å‡ºåŠ›ã—ã¾ã™ã€‚
- **ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å‡¦ç†ã«ã‚ˆã‚Šã€ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
  - ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°ã®è¨­å®šãŒã§ãã¾ã™ã€‚å„ç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®šã—ã¦ãã ã•ã„ã€‚

- **`vt_detection`ã®ã—ãã„å€¤è¨­å®š**: ãƒãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦æ¡ç”¨ã™ã‚‹APKã®VirusTotalæ¤œçŸ¥æ•°ã®ã—ãã„å€¤ã‚’è¨­å®šã§ãã¾ã™ã€‚æŒ‡å®šã—ãŸæ¤œçŸ¥æ•°**ä»¥ä¸Š**ã®ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
- **`vt_scan_date`ã®ã—ãã„å€¤è¨­å®š**: ãƒãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦æ¡ç”¨ã™ã‚‹APKã®VirusTotalæœ€æ–°ã‚¹ã‚­ãƒ£ãƒ³æ—¥æ™‚ã®ã—ãã„å€¤ã‚’è¨­å®šã§ãã¾ã™ã€‚æŒ‡å®šã—ãŸæ—¥æ™‚**ä»¥é™**ã®APKã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
- **æ¤œä½“æ•°æŒ‡å®š**: æ¡ä»¶ã«å½“ã¦ã¯ã¾ã‚‹è‰¯æ€§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒãƒ«ã‚¦ã‚§ã‚¢ã®åé›†æ¤œä½“æ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
- **Google Play Storeãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: è‰¯æ€§ã‚µãƒ³ãƒ—ãƒ«ã‚’Google Play Storeã®ã‚¢ãƒ—ãƒªã®ã¿ã«åˆ¶é™ã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆconfig.yamlã® `collection.google_play_only` ã§è¨­å®šå¯èƒ½ï¼‰ã€‚
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµæœã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–**: AndroZooãŒå…¬è¡¨ã—ã¦ã„ã‚‹ãƒ¬ã‚³ãƒ¼ãƒ‰ã¯2300ä¸‡ãƒ¬ã‚³ãƒ¼ãƒ‰ã»ã©ã‚ã‚Šã€ä¸Šè¨˜ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã«æ™‚é–“ãŒæ›ã‹ã‚Šã¾ã™ã€‚ä¸€åº¦å®Ÿè¡Œã—ãŸæ¡ä»¶ã®ã‚‚ã®ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥åŒ–ã™ã‚‹ã“ã¨ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œæ™‚é–“ã‚’1ç§’æœªæº€ã«å‰Šæ¸›ã—ã¾ã™ã€‚
- **ãƒ­ã‚°å‡ºåŠ›**: `log` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«å®Ÿè¡Œãƒ­ã‚°ã‚’å‡ºåŠ›ã€‚ãƒ­ã‚°åã¯æ—¥æœ¬æ¨™æº–æ™‚ã§è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚
- **ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: `Downloads` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã€è‰¯æ€§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’åˆ†ã‘ã¦ä¿å­˜ã—ã¾ã™ã€‚

## ç”¨é€”

ç‰¹å®šã®æ±ºã¾ã£ã¦ã„ã‚‹ãƒãƒƒã‚·ãƒ¥å€¤ã‚’å…ƒã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã®ã§ã¯ãªãã€APKã‚’ç„¡å·®åˆ¥ã«åºƒãåé›†ã™ã‚‹ã“ã¨ã«é©ã—ã¦ã„ã¾ã™ã€‚

## ğŸ“¦ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

GitHubã‹ã‚‰ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã€å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

### uvã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼ˆæ¨å¥¨ï¼‰
```sh
git clone https://github.com/Almond-Latte/ApkDownloader.git
cd ApkDownloader
uv sync
cp .env.sample .env
```

### pipã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ
```sh
git clone https://github.com/Almond-Latte/ApkDownloader.git
cd ApkDownloader
pip install -r requirements.txt
cp .env.sample .env
```

## ğŸ”‘ è¨­å®š

### 1. APIã‚­ãƒ¼ã®è¨­å®š
`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã«AndroZooã®APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

```bash
# .env
API_KEY = 'YOUR_ANDROZOO_API_KEY'
```

> [!NOTE]
> AndroZoo API Keyã‚’å–å¾—ã—ã¦ã„ãªã„å ´åˆã¯ã€[AndroZoo Access](https://androzoo.uni.lu/access)ã«å¾“ã„API Keyã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚

### 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä¾‹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãã ã•ã„ï¼š

```bash
cp config.yaml.example config.yaml
```

`config.yaml` ã‚’ç·¨é›†ã—ã¦ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºï¼š

```yaml
# config.yaml
# ã‚µãƒ³ãƒ—ãƒ«åé›†è¨­å®š
collection:
  min_detections_for_malware: 5  # VirusTotalæ¤œçŸ¥ã—ãã„å€¤
  benign_samples: 1000            # ã‚¯ãƒªãƒ¼ãƒ³ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ•°
  malware_samples: 500             # ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ•°
  google_play_only: true           # è‰¯æ€§ã‚µãƒ³ãƒ—ãƒ«ã‚’Google Play Storeã®ã¿ã«åˆ¶é™

# ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æœŸé–“
filtering:
  date_from: "2021-04-01 00:00:00"   # ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–‹å§‹æ—¥
  date_until: "2024-12-31 23:59:59"  # ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµ‚äº†æ—¥

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
performance:
  parallel_downloads: 12           # åŒæ™‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°

# å‹•ä½œã‚ªãƒ—ã‚·ãƒ§ãƒ³
behavior:
  skip_hash_verification: false    # SHA256æ¤œè¨¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹å ´åˆã¯true
  random_seed: 42                  # å†ç¾æ€§ã®ãŸã‚ã®ã‚·ãƒ¼ãƒ‰ï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã®å ´åˆã¯nullï¼‰
```

> [!IMPORTANT]
> ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•°ã«ã¯åˆ¶ç´„ãŒã‚ã‚Šã¾ã™ã€‚AndroZooã«è² è·ã‚’ã‹ã‘ã¦ã—ã¾ã‚ã¬ã‚ˆã†ã”æ³¨æ„ãã ã•ã„ã€‚å¿…ãš [AndroZoo API Documentation](https://androzoo.uni.lu/api_doc) ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

## â–¶ å®Ÿè¡Œæ–¹æ³•

### Surveyãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‰ã®èª¿æŸ»ï¼‰
```bash
# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã›ãšã«ã‚µãƒ³ãƒ—ãƒ«ã‚’åˆ†æ
uv run python src/ApkDownloader.py survey --n-cleanware 1000 --n-malware 500

# ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
uv run python src/ApkDownloader.py survey --export-hashes analysis.csv

# ã‚«ã‚¹ã‚¿ãƒ æ—¥ä»˜ç¯„å›²ã§èª¿æŸ»
uv run python src/ApkDownloader.py survey \
    --date-start "2023-01-01 00:00:00" \
    --date-end "2024-12-31 23:59:59" \
    --export-hashes survey_results.csv
```

### Downloadãƒ¢ãƒ¼ãƒ‰
```bash
# åŸºæœ¬çš„ãªãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
uv run python src/ApkDownloader.py download --apk-list latest.csv --n-cleanware 100 --n-malware 50

# pythonã‚’ç›´æ¥ä½¿ç”¨
python src/ApkDownloader.py download --apk-list latest.csv --n-cleanware 100 --n-malware 50
```

### ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãŸé«˜åº¦ãªä½¿ç”¨æ–¹æ³•
```bash
# ã¾ãšã€åˆ©ç”¨å¯èƒ½æ€§ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«èª¿æŸ»
python src/ApkDownloader.py survey \
    --apk-list latest.csv \
    --n-cleanware 2000 \
    --n-malware 1000 \
    --date-start "2023-01-01 00:00:00" \
    --date-end "2024-12-01 00:00:00" \
    --malware-threshold 10 \
    --export-hashes candidates.csv

# çµæœã«æº€è¶³ã—ãŸã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
python src/ApkDownloader.py download \
    --apk-list latest.csv \
    --n-cleanware 2000 \
    --n-malware 1000 \
    --date-start "2023-01-01 00:00:00" \
    --date-end "2024-12-01 00:00:00" \
    --malware-threshold 10 \
    --verify-hash
```

### ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---------|------|
| `survey` | ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã›ãšã«APKã‚µãƒ³ãƒ—ãƒ«ã‚’åˆ†æã€‚çµ±è¨ˆã€åˆ†å¸ƒè¡¨ç¤ºã€ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãŒå¯èƒ½ |
| `download` | æŒ‡å®šã•ã‚ŒãŸæ¡ä»¶ã«åŸºã¥ã„ã¦APKãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ |

### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆconfig.yamlã‹ã‚‰ï¼‰ | å¯¾å¿œã‚³ãƒãƒ³ãƒ‰ |
| `--apk-list` | APKãƒªã‚¹ãƒˆã¸ã®ãƒ‘ã‚¹ï¼ˆCSVã¾ãŸã¯Featherãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ | config.yamlã®å€¤ | ä¸¡æ–¹ |
| `--n-cleanware` | ã‚¯ãƒªãƒ¼ãƒ³ã‚¦ã‚§ã‚¢ã‚µãƒ³ãƒ—ãƒ«æ•° | benign_samplesã®å€¤ | ä¸¡æ–¹ |
| `--n-malware` | ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚µãƒ³ãƒ—ãƒ«æ•° | malware_samplesã®å€¤ | ä¸¡æ–¹ |
| `--date-start` | ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–‹å§‹æ—¥ï¼ˆYYYY-MM-DD HH:MM:SSï¼‰ | date_fromã®å€¤ | ä¸¡æ–¹ |
| `--date-end` | ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµ‚äº†æ—¥ï¼ˆYYYY-MM-DD HH:MM:SSï¼‰ | date_untilã®å€¤ | ä¸¡æ–¹ |
| `--malware-threshold` | VirusTotalæ¤œçŸ¥ã—ãã„å€¤ï¼ˆ0-100ï¼‰ | min_detections_for_malwareã®å€¤ | ä¸¡æ–¹ |
| `--export-hashes` | ãƒãƒƒã‚·ãƒ¥ãƒªã‚¹ãƒˆã‚’CSVãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ | ãªã— | survey |
| `--show-distribution` | æ™‚æœŸåˆ¥åˆ†å¸ƒã‚’è¡¨ç¤º | True | survey |
| `--distribution-granularity` | æ™‚æœŸã®ç²’åº¦ï¼ˆyear/quarter/monthï¼‰ | year | survey |
| `--download-dir` | APKä¿å­˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | ./downloads | download |
| `--random-seed` | å†ç¾æ€§ã®ãŸã‚ã®ã‚·ãƒ¼ãƒ‰å€¤ | 42 | download |
| `--verify-hash` | æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚·ãƒ¥æ¤œè¨¼ | False | download |

è‡ªå‹•ã§ãƒ­ã‚°ã®è¨­å®šã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆã€APKã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã™ã€‚

![state of progress](https://github.com/Almond-Latte/ApkDownloader/assets/147462539/ee5924a3-1f2b-400a-85e8-3b82c0139665)

å®Ÿè¡Œä¸­æ–­ã™ã‚‹éš›ã«ã¯`Ctrl + C`ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ç¾åœ¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­ã®APKã¯ä¸­æ–­ã•ã‚Œã€ä¸å®Œå…¨ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸAPKã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
downloads/
â”œâ”€â”€ cleanware/     # è‰¯æ€§APKãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ malware/       # æ‚ªæ€§APKãƒ•ã‚¡ã‚¤ãƒ«

logs/              # å®Ÿè¡Œãƒ­ã‚°

_cache/            # ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
```

## ğŸ”§ é–‹ç™º

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
```bash
uv run ruff check src/
uv run pyright src/
```

### ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
```bash
uv run ruff format src/
```

ğŸ™ ã‚ˆã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ©ã‚¤ãƒ•ã‚’ï¼
è³ªå•ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚‹å ´åˆã¯ã€ãŠæ°—è»½ã«[Issues](https://github.com/Almond-Latte/ApkDownloader/issues)ã«æŠ•ç¨¿ã—ã¦ãã ã•ã„ã€‚